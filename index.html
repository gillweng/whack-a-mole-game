<script>
    const holes = document.querySelectorAll('.hole');
    const moles = document.querySelectorAll('.mole');
    const scoreDisplay = document.getElementById('score');
    const timeDisplay = document.getElementById('time');
    const startBtn = document.getElementById('start-btn');

    let score = 0;
    let timeLeft = 30;
    let gameActive = false;
    let gameTimer;
    let countdownTimer;
    let moleTimer;

    const backgroundMusic = new Audio('background-music.mp3');
    backgroundMusic.loop = true;

    function playHitSound() {
        const hitSound = new Audio('hit-sound.mp3'); // 創建新的音效實例
        hitSound.play().catch(error => console.log('音效播放失敗:', error));
    }

    function randomHole() {
        const idx = Math.floor(Math.random() * holes.length);
        return holes[idx];
    }

    function showMole() {
        if (!gameActive) return;

        const hole = randomHole();
        const mole = hole.querySelector('.mole');

        mole.classList.remove('hidden');

        moleTimer = setTimeout(() => {
            mole.classList.add('hidden');
            if (gameActive) showMole();
        }, Math.max(300, 1000 - score * 20));
    }

    moles.forEach(mole => {
        mole.addEventListener('click', () => {
            if (!mole.classList.contains('hidden') && gameActive) {
                score++;
                scoreDisplay.textContent = score;
                mole.classList.add('hidden');
                playHitSound(); // 確保每次點擊都有獨立的音效播放
            }
        });
    });

    function startCountdown() {
        countdownTimer = setInterval(() => {
            timeLeft--;
            timeDisplay.textContent = timeLeft;
            if (timeLeft <= 0) {
                endGame();
            }
        }, 1000);
    }

    function startGame() {
        gameActive = true;
        startBtn.disabled = true;
        startBtn.textContent = '遊戲進行中...';
        backgroundMusic.play().catch(error => console.log('背景音樂播放失敗:', error));
        showMole();
        startCountdown();
    }

    function endGame() {
        gameActive = false;
        clearInterval(countdownTimer);
        clearTimeout(moleTimer);
        backgroundMusic.pause();
        backgroundMusic.currentTime = 0;
        startBtn.disabled = false;
        startBtn.textContent = '重新開始';
        alert(`遊戲結束！你的得分是：${score}`);
    }

    startBtn.addEventListener('click', () => {
        if (gameActive) return;

        gameActive = true;
        score = 0;
        timeLeft = 30;
        scoreDisplay.textContent = score;
        timeDisplay.textContent = timeLeft;
        startGame();
    });
</script>
